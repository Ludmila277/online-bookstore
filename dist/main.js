(()=>{"use strict";const e=e=>{const t=document.querySelector(".cart-counter");t.textContent=e,t.style.display=e>0?"block":"none"};let t=(()=>{try{return JSON.parse(localStorage.getItem("cartItems"))||[]}catch(e){return console.error("Ошибка парсинга cartItems:",e),[]}})(),n=t.length;e(n);document.addEventListener("click",(s=>{(s=>{if(s.target.classList.contains("info_btn")){const i=s.target,c=i.dataset.bookId,r=i.classList.contains("added");if(r){const e=t.indexOf(c);e>-1&&(t.splice(e,1),n--,n=t.length)}else t.push(c),n++,n=t.length;((e,t)=>{e.textContent=t?"In the cart":"Buy now",e.classList.toggle("added",t)})(i,!r),a=t,localStorage.setItem("cartItems",JSON.stringify(a)),e(n)}var a})(s)}));const s=document.querySelector(".button-container__load"),a=document.querySelector(".cards-block"),i=document.querySelectorAll(".main-list__item"),c=new URLSearchParams;let r=0;const l=JSON.parse(localStorage.getItem("cartItems"))??[],o=async()=>{const e=(()=>{const e=document.querySelector(".main-list__item_active");return e?e.dataset.category:null})();if(!e)return;c.set("q",`subject:${e}`),c.append("key","AIzaSyD4Bq-elrnfD4ATiRxzxTOudiUj7lQQM5I"),c.append("printType","books"),c.append("startIndex",r),c.append("maxResults","6"),c.append("langRestrict","en");const t=`https://www.googleapis.com/books/v1/volumes?${c.toString()}`;try{const e=await fetch(t),n=await e.json();u(n.items)}catch(e){console.error("Ошибка загрузки книг:",e)}},d=e=>{const t=e.target.closest(".main-list__item");t&&(i.forEach((e=>e.classList.remove("main-list__item_active"))),t.classList.add("main-list__item_active"),a.innerHTML="",r=0,o())};i.forEach((e=>{e.addEventListener("click",d)}));const u=e=>{let t=" ",n="",s="",i="",c="",r="",o="";e.forEach((e=>{n=e.volumeInfo?.authors?.join(", ")||"Unknown",s=e.volumeInfo.imageLinks.thumbnail||"",t=e.volumeInfo.title||"Unknown",o=e.volumeInfo.description||"No description",i=e.saleInfo.retailPrice?e.saleInfo.retailPrice.amount+" "+e.saleInfo.retailPrice.currencyCode:"Unavailable",r=e.volumeInfo.ratingsCount||0,c=Math.round(e.volumeInfo.averageRating||0);let d=c/5*100;const u=l.includes(e.id);let m=`<svg width="160" height="32" viewBox="0 0 160 32">\n      <defs>\n        <mask id="perc">\n          <rect x="0" y="0" width="100%" height="100%" fill="white" />\n          <rect x="${d}%"  y="0" width="100%" height="100%" fill="grey" />\n        </mask>\n\n        <symbol viewBox="0 0 32 32" id="star">\n          <path d="M31.547 12a.848.848 0 00-.677-.577l-9.427-1.376-4.224-8.532a.847.847 0 00-1.516 0l-4.218 8.534-9.427 1.355a.847.847 0 00-.467 1.467l6.823 6.664-1.612 9.375a.847.847 0 001.23.893l8.428-4.434 8.432 4.432a.847.847 0 001.229-.894l-1.615-9.373 6.822-6.665a.845.845 0 00.214-.869z" />\n        </symbol>\n        <symbol viewBox="0 0 160 32" id="stars">\n          <use xlink:href="#star" x="-64" y="0"></use>\n          <use xlink:href="#star" x="-32" y="0"></use>\n          <use xlink:href="#star" x="0" y="0"></use>\n          <use xlink:href="#star" x="32" y="0"></use>\n          <use xlink:href="#star" x="64" y="0"></use>\n        </symbol>\n      </defs>\n      <use\n        xlink:href="#stars"\n        fill="yellow"\n        stroke="black"\n        mask="url(#perc)"\n      ></use>\n    </svg>`;a.innerHTML+=`\n                <div class="cards_item">\n                   <img src = ${s} alt="book cover" class="card_img">\n\n                  <div class="card_info">\n                    <div class="info_author">${n}</div>\n                    <div class="info_title">${t}</div>\n                    <div class="info_raiting">\n                        <div>${m}</div>\n                        ${r} review</div>\n                    <p class="info_text">${o}</p>\n                    <div class="info_cost">${i}</div>\n                   <button class="info_btn ${u?"added":""}" data-book-id="${e.id}">${u?"In the cart":"buy now"}</button>\n                  </div>\n                  </div>\n                </div>`}))};s.addEventListener("click",(()=>{r+=6,o()})),document.addEventListener("DOMContentLoaded",(()=>{const e=i[0];e&&e.classList.add("main-list__item_active"),document.querySelector(".main-list__item_active")||i[0].classList.add("main-list__item_active"),o()}));const m=[{url:"./src/img/banner.png"},{url:"./src/img/banner2.png"},{url:"./src/img/banner3.png"}];let v=0;const g=document.querySelector(".slider"),h=g.querySelector(".slider-images"),f=g.querySelector(".slider-dots");var y;function _(){h.querySelector(".active").classList.remove("active"),h.querySelector(`.n${v}`).classList.add("active");let e=document.querySelector(".slider-dots");e.querySelector(".active").classList.remove("active"),e.querySelector(`.n${v}`).classList.add("active")}(y=m)&&y.length&&m.forEach(((e,t)=>{let n=document.createElement("div");n.classList=`image n${t} ${t?"":"active"}`,n.dataset.index=t,n.style.backgroundImage=`url('${e.url}')`,h.appendChild(n)})),m.forEach(((e,t)=>{let n=document.createElement("div");n.className=`slider-dots__item n${t} ${t?"":"active"}`,n.dataset.index=t,n.addEventListener("click",(function(){v=+this.dataset.index,_(),f.querySelector(".active").classList.remove(".active"),this.classList.add(".active")})),f.appendChild(n)})),setInterval((()=>{v=v===m.length-1?0:v+1,_()}),5e3)})();